name: Build â€“ Presentations

on:
  workflow_call:
    inputs:
      python-version:
        description: Python version
        required: false
        type: string
        default: "3.12"
      src_dir:
        description: (Unused) Kept for compatibility.
        required: false
        type: string
        default: "docs"
      template_path:
        description: (Unused) Kept for compatibility.
        required: false
        type: string
        default: "templates/presentation-template.pptx"
      out_dir:
        description: (Unused) Kept for compatibility.
        required: false
        type: string
        default: "exports/presentations"

permissions:
  contents: read

jobs:
  generate:
    name: Generate presentations
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ inputs.python-version }}

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install PyYAML python-pptx

      - name: Ensure output folders exist
        run: |
          mkdir -p presentations
          mkdir -p presentations/presentations
          mkdir -p releases/presentation/presentations

      - name: Run generator
        shell: bash
        run: |
          set -euo pipefail
          # Pass only the filename so the script's standard output dir
          # doesn't duplicate the path.
          python ./generate_presentation.py \
            --create-pptx \
            --release \
            --output architecture_as_code_presentation.pptx

      - name: Show generated files (debug)
        run: |
          echo "=== presentations/ ==="
          find presentations -maxdepth 3 -type f -print || true
          echo "=== releases/presentation/ ==="
          find releases/presentation -maxdepth 3 -type f -print || true

      - name: Upload artefact
        uses: actions/upload-artifact@v4
        with:
          name: presentations
          path: |
            presentations/
            releases/presentation/
          if-no-files-found: error
          retention-days: 30