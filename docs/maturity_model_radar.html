<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Architecture as Code Maturity Radar</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/picnic" />
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 2rem;
      background-color: #f9fafb;
      color: #1f2933;
      line-height: 1.6;
    }

    header {
      margin-bottom: 2rem;
    }

    h1 {
      margin-bottom: 0.5rem;
    }

    .intro {
      max-width: 60rem;
    }

    fieldset {
      border: 1px solid #d2d6dc;
      padding: 1.5rem;
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
      background-color: #ffffff;
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.08);
    }

    legend {
      font-weight: 600;
      padding: 0 0.5rem;
    }

    .question {
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .question:last-of-type {
      border-bottom: none;
      padding-bottom: 0;
    }

    .question .question-text {
      display: block;
      font-weight: 500;
    }

    .question .options {
      margin-top: 0.5rem;
      display: flex;
      gap: 1rem;
    }

    .question .options label {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 400;
      cursor: pointer;
    }

    .question .options label .checkable {
      margin: 0;
    }

    button {
      margin-right: 0.75rem;
    }

    #radarDiagram {
      margin-top: 2rem;
      border: 1px solid #d2d6dc;
      border-radius: 0.75rem;
      padding: 1.5rem;
      background-color: #ffffff;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.12);
    }

    .diagram-error {
      border: 1px solid #ef4444;
      background-color: #fef2f2;
      color: #991b1b;
      padding: 1.25rem;
      border-radius: 0.75rem;
    }

    .diagram-error .error-message {
      font-weight: 600;
      margin-top: 0.75rem;
    }

    .diagram-error details {
      margin-top: 1rem;
    }

    .diagram-error textarea {
      width: 100%;
      margin-top: 0.75rem;
      font-family: "Fira Code", "Courier New", Courier, monospace;
      font-size: 0.9rem;
      background-color: #ffffff;
      color: #111827;
      border: 1px solid #d1d5db;
      border-radius: 0.5rem;
      padding: 0.75rem;
      resize: vertical;
    }

    .diagram-error button {
      margin-top: 0.75rem;
    }

    #jsonOutput {
      width: 100%;
      height: 16rem;
      font-family: "Fira Code", "Courier New", Courier, monospace;
      margin-top: 1rem;
    }

    .actions {
      margin-top: 1rem;
    }

    .result-summary {
      margin-top: 2rem;
    }

    .result-summary table {
      width: 100%;
      border-collapse: collapse;
    }

    .result-summary th,
    .result-summary td {
      border: 1px solid #d2d6dc;
      padding: 0.75rem;
      text-align: left;
    }

    .result-summary th {
      background-color: #f1f5f9;
    }

    .improvement-suggestions {
      margin-top: 2rem;
    }

    .improvement-suggestions ol {
      padding-left: 1.25rem;
    }

    .improvement-suggestions li {
      margin-bottom: 1rem;
    }

    .improvement-suggestions li:last-of-type {
      margin-bottom: 0;
    }

    .improvement-suggestions .question-label {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .improvement-suggestions .reference-link {
      display: inline-block;
      margin-top: 0.25rem;
    }

    @media (max-width: 768px) {
      body {
        margin: 1rem;
      }

      fieldset {
        padding: 1rem;
      }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11.3.0/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: false });

    const aspects = [
      {
        key: "iac",
        name: "Infrastructure as code (IaC)",
        questions: [
          "Are all infrastructure definitions stored in version control with peer review required prior to merge?",
          "Is automated validation or linting run on every infrastructure code change before deployment?",
          "Do environment deployments rely solely on declarative templates rather than manual changes?",
          "Are infrastructure modules reusable and parameterised to promote consistency across environments?",
          "Is drift detection automated and reviewed regularly to ensure infrastructure matches the declared state?"
        ]
      },
      {
        key: "aac",
        name: "Architecture as code (AaC)",
        questions: [
          "Are architecture models generated from source-controlled code or domain-specific language definitions?",
          "Do teams update architecture models as part of the same change when system behaviour evolves?",
          "Is traceability maintained between architecture components and the owning teams or repositories?",
          "Are architecture decisions captured as code-backed records that undergo pull-request review?",
          "Is automated validation applied to architecture models to detect inconsistencies or missing relationships?"
        ]
      },
      {
        key: "containers",
        name: "Containerisation & orchestration as code",
        questions: [
          "Are container images and orchestration manifests generated from version-controlled definitions reviewed by the owning team?",
          "Do pipelines automatically build, scan and publish container images before release?",
          "Is cluster configuration managed declaratively with automated reconciliation to enforce desired state?",
          "Are rollout strategies (such as blue-green or canary) codified and repeatedly tested in non-production environments?",
          "Is runtime configuration (including secrets and policies) delivered through code rather than manual console changes?"
        ]
      },
      {
        key: "policy",
        name: "Policy as code (PaC) & Security as code",
        questions: [
          "Are governance and security requirements expressed in machine-readable policies stored in version control?",
          "Do automated checks enforce policy compliance in CI/CD pipelines before promotion to higher environments?",
          "Is policy code peer reviewed alongside the application or infrastructure change it governs?",
          "Are policy violations surfaced through automated alerts with actionable remediation guidance?",
          "Is there a feedback loop that updates policies based on new threats, incidents or regulatory changes?"
        ]
      },
      {
        key: "governance",
        name: "Governance as code",
        questions: [
          "Are approval workflows, branch protections and role definitions codified and version controlled?",
          "Do governance automations capture decision history and rationale as part of the workflow output?",
          "Is governance code tested in lower environments before it is applied to production repositories?",
          "Are exceptions to governance policies time-bound, tracked and reviewed automatically?",
          "Is governance tooling accessible to non-developers through templates or guided interfaces sourced from the same codebase?"
        ]
      },
      {
        key: "compliance",
        name: "Compliance as code",
        questions: [
          "Are regulatory controls translated into executable checks that run continuously against live environments?",
          "Does the organisation maintain reusable compliance baselines or templates for common regulations?",
          "Is evidence collection automated and stored alongside compliance code for audit readiness?",
          "Are compliance findings integrated with issue tracking to ensure timely remediation and verification?",
          "Do compliance automations generate dashboards or reports that stakeholders review on a scheduled cadence?"
        ]
      },
      {
        key: "testing",
        name: "Testing as code",
        questions: [
          "Are automated tests defined for every codified artefact, including infrastructure, policies and architecture models?",
          "Do pipelines execute the full testing suite on every merge or release candidate?",
          "Is test coverage monitored and improved through targeted backlog items when gaps emerge?",
          "Are failure scenarios rehearsed with automated chaos or resilience tests to validate recovery procedures?",
          "Is test data managed as code with repeatable seeding and sanitisation routines?"
        ]
      },
      {
        key: "documentation",
        name: "Documentation as code",
        questions: [
          "Is documentation authored in version-controlled markup languages with enforced review workflows?",
          "Do automated builds publish documentation outputs (web, PDF, diagrams) from the same source repository?",
          "Are documentation updates included in the definition of done for relevant product or platform changes?",
          "Is diagram generation automated from code or structured data to eliminate manual drawing efforts?",
          "Are documentation quality checks (such as link validation and style linting) automated in CI/CD pipelines?"
        ]
      },
      {
        key: "knowledge",
        name: "Knowledge & culture as code",
        questions: [
          "Is organisational knowledge captured in structured repositories with clear ownership and contribution guidelines?",
          "Do onboarding and learning journeys exist as code-based playbooks or scripts executed during induction?",
          "Are retrospectives and continuous improvement actions tracked in version-controlled artefacts with follow-up automation?",
          "Is cultural guidance (values, rituals, ceremonies) embedded into tooling such as bots, templates or workflow prompts?",
          "Are knowledge repositories regularly reviewed through automated reminders to ensure relevance and accuracy?"
        ]
      },
      {
        key: "management",
        name: "Management as code",
        questions: [
          "Are operating models, team topologies and responsibilities documented through code-driven templates?",
          "Do leadership ceremonies (such as portfolio reviews) run from standardised agendas or dashboards generated from code?",
          "Are performance and delivery metrics collected automatically and surfaced through shared management dashboards?",
          "Is resource allocation or staffing managed through codified workflows with automated approvals and audit trails?",
          "Are management playbooks iterated through pull requests with participation from the leadership community?"
        ]
      }
    ];

    const suggestionIndex = {
      iac: [
        {
          recommendation:
            "Adopt Git-based workflows for infrastructure modules and enforce peer review gates to keep definitions auditable and collaborative.",
          reference: {
            title:
              "Chapter 03 – Version Control · Git-based workflow for infrastructure",
            url: "03_version_control/#git-based-workflow-for-infrastructure"
          }
        },
        {
          recommendation:
            "Embed linting and validation stages in CI pipelines so every infrastructure change benefits from automated quality gates.",
          reference: {
            title:
              "Chapter 05 – Automation, DevOps, and CI/CD · Fail-fast feedback and progressive validation",
            url: "05_automation_devops_cicd/#fail-fast-feedback-and-progressive-validation"
          }
        },
        {
          recommendation:
            "Transition environment provisioning to declarative templates and treat them as the single source of truth for deployments.",
          reference: {
            title:
              "Chapter 02 – Fundamental Principles · The declarative approach in Architecture as Code",
            url: "02_fundamental_principles/#the-declarative-approach-in-architecture-as-code"
          }
        },
        {
          recommendation:
            "Structure infrastructure libraries as reusable modules with versioned interfaces to drive consistency across teams.",
          reference: {
            title:
              "Chapter 24 – Modern Best Practices · Module design guidelines",
            url: "24_best_practices/#module-design-guidelines"
          }
        },
        {
          recommendation:
            "Automate drift detection and schedule reviews that reconcile live environments with the declared state.",
          reference: {
            title:
              "Chapter 02 – Fundamental Principles · Understanding architectural drift",
            url: "02_fundamental_principles/#understanding-architectural-drift"
          }
        }
      ],
      aac: [
        {
          recommendation:
            "Generate architecture models from code-first tooling so diagrams and definitions share a common source of truth.",
          reference: {
            title:
              "Chapter 06 – Structurizr · Structurizr: Architecture Modeling as Code",
            url: "06_structurizr/#structurizr-architecture-modeling-as-code"
          }
        },
        {
          recommendation:
            "Update architecture models alongside behavioural changes by running Structurizr automation in every pull request.",
          reference: {
            title:
              "Chapter 06 – Structurizr · Integration with CI/CD pipelines",
            url: "06_structurizr/#integration-with-ci-cd-pipelines"
          }
        },
        {
          recommendation:
            "Link components to accountable teams through governance workflows so traceability stays transparent.",
          reference: {
            title:
              "Chapter 11 – Governance as Code · Implementing approval processes with pull requests",
            url: "11_governance_as_code/#implementing-approval-processes-with-pull-requests"
          }
        },
        {
          recommendation:
            "Capture architectural reasoning in reviewed Architecture Decision Records that live with the codebase.",
          reference: {
            title:
              "Chapter 04 – Architecture Decision Records · What are Architecture Decision Records?",
            url: "04_adr/#what-are-architecture-decision-records"
          }
        },
        {
          recommendation:
            "Add automated validation of architecture models to surface missing relationships before release.",
          reference: {
            title:
              "Chapter 06 – Structurizr · Integration with CI/CD pipelines",
            url: "06_structurizr/#integration-with-ci-cd-pipelines"
          }
        }
      ],
      containers: [
        {
          recommendation:
            "Store Dockerfiles and orchestration manifests in Git so container behaviour remains reproducible.",
          reference: {
            title:
              "Chapter 07 – Containerisation and Orchestration · The role of container technology within Architecture as Code",
            url: "07_containerization/#the-role-of-container-technology-within-architecture-as-code"
          }
        },
        {
          recommendation:
            "Automate image builds, scanning, and publishing through CI so every release meets the platform's guardrails.",
          reference: {
            title:
              "Chapter 07 – Containerisation and Orchestration · The role of container technology within Architecture as Code",
            url: "07_containerization/#the-role-of-container-technology-within-architecture-as-code"
          }
        },
        {
          recommendation:
            "Manage cluster configuration declaratively and let controllers reconcile the desired state continuously.",
          reference: {
            title:
              "Chapter 07 – Containerisation and Orchestration · Kubernetes as an orchestration platform",
            url: "07_containerization/#kubernetes-as-an-orchestration-platform"
          }
        },
        {
          recommendation:
            "Codify blue-green and canary roll-outs inside delivery pipelines to practise safe progressive delivery.",
          reference: {
            title:
              "Chapter 05 – Automation, DevOps, and CI/CD · Progressive deployment strategies",
            url: "05_automation_devops_cicd/#progressive-deployment-strategies"
          }
        },
        {
          recommendation:
            "Deliver runtime configuration, secrets, and policies from code-defined sources instead of manual consoles.",
          reference: {
            title:
              "Chapter 07 – Containerisation and Orchestration · Kubernetes as an orchestration platform",
            url: "07_containerization/#kubernetes-as-an-orchestration-platform"
          }
        }
      ],
      policy: [
        {
          recommendation:
            "Express governance and security requirements as machine-readable policies kept under version control.",
          reference: {
            title:
              "Chapter 10 – Policy and Security as Code · Introduction and context",
            url: "10_policy_and_security/#introduction-and-context"
          }
        },
        {
          recommendation:
            "Enforce automated compliance checks in CI/CD so policy breaches are caught before promotion.",
          reference: {
            title:
              "Chapter 10 – Policy and Security as Code · Policy-as-Code operating model",
            url: "10_policy_and_security/#policy-as-code-operating-model"
          }
        },
        {
          recommendation:
            "Peer review policy code alongside the infrastructure or application change it governs to keep accountability shared.",
          reference: {
            title:
              "Chapter 10 – Policy and Security as Code · Policy-as-Code operating model",
            url: "10_policy_and_security/#policy-as-code-operating-model"
          }
        },
        {
          recommendation:
            "Stream policy violations into actionable alerts with contextual remediation guidance from the automation stack.",
          reference: {
            title:
              "Chapter 10 – Policy and Security as Code · Integrating policy automation into European enterprises",
            url: "10_policy_and_security/#integrating-policy-automation-into-european-enterprises"
          }
        },
        {
          recommendation:
            "Continuously refine policy libraries using threat intelligence and incident feedback following the implementation roadmap.",
          reference: {
            title:
              "Chapter 10 – Policy and Security as Code · Implementation roadmap for European delivery teams",
            url: "10_policy_and_security/#implementation-roadmap-for-european-delivery-teams"
          }
        }
      ],
      governance: [
        {
          recommendation:
            "Codify approval workflows, branch protections, and roles via pull-request driven governance repositories.",
          reference: {
            title:
              "Chapter 11 – Governance as Code · Implementing approval processes with pull requests",
            url: "11_governance_as_code/#implementing-approval-processes-with-pull-requests"
          }
        },
        {
          recommendation:
            "Capture decision history and rationale automatically within governance pipelines to maintain a complete audit trail.",
          reference: {
            title:
              "Chapter 11 – Governance as Code · Implementing approval processes with pull requests",
            url: "11_governance_as_code/#implementing-approval-processes-with-pull-requests"
          }
        },
        {
          recommendation:
            "Test governance code in lower environments with automated validations before promoting changes to production.",
          reference: {
            title:
              "Chapter 11 – Governance as Code · Implementing approval processes with pull requests",
            url: "11_governance_as_code/#implementing-approval-processes-with-pull-requests"
          }
        },
        {
          recommendation:
            "Track policy exceptions as time-boxed code artefacts so drift is visible and remediation is enforced.",
          reference: {
            title:
              "Chapter 26 – Anti-Patterns · Policy drift through manual exceptions",
            url: "26_aac_anti_patterns/#policy-drift-through-manual-exceptions"
          }
        },
        {
          recommendation:
            "Provide accessible tooling, templates, and chat integrations so non-developers can contribute safely.",
          reference: {
            title:
              "Chapter 11 – Governance as Code · Tooling to enable non-developers",
            url: "11_governance_as_code/#tooling-to-enable-non-developers"
          }
        }
      ],
      compliance: [
        {
          recommendation:
            "Translate regulatory controls into executable checks that run continuously across live environments.",
          reference: {
            title:
              "Chapter 12 – Compliance and Regulatory Adherence",
            url: "12_compliance/#compliance-and-regulatory-adherence"
          }
        },
        {
          recommendation:
            "Maintain reusable compliance baselines and templates to accelerate regulatory onboarding.",
          reference: {
            title:
              "Chapter 12 – Compliance and Regulatory Adherence",
            url: "12_compliance/#compliance-and-regulatory-adherence"
          }
        },
        {
          recommendation:
            "Automate evidence collection and store artefacts alongside compliance code for audit readiness.",
          reference: {
            title:
              "Chapter 12 – Compliance and Regulatory Adherence",
            url: "12_compliance/#compliance-and-regulatory-adherence"
          }
        },
        {
          recommendation:
            "Feed compliance findings into dashboards and remediation workflows so follow-up happens in the open.",
          reference: {
            title:
              "Chapter 12 – Compliance and Regulatory Adherence · Policy-driven infrastructure and governance",
            url: "12_compliance/#policy-driven-infrastructure-and-governance"
          }
        },
        {
          recommendation:
            "Schedule stakeholder reviews of compliance dashboards generated from automation to sustain cadence.",
          reference: {
            title:
              "Chapter 12 – Compliance and Regulatory Adherence · Policy-driven infrastructure and governance",
            url: "12_compliance/#policy-driven-infrastructure-and-governance"
          }
        }
      ],
      testing: [
        {
          recommendation:
            "Define automated tests for every codified artefact so infrastructure, policies, and models gain the same assurance as software.",
          reference: {
            title:
              "Chapter 13 – Testing Strategies · Testing strategies for Infrastructure as Code",
            url: "13_testing_strategies/#testing-strategies-for-infrastructure-as-code"
          }
        },
        {
          recommendation:
            "Run the full test suite on each merge or release candidate to keep quality gates reliable.",
          reference: {
            title:
              "Chapter 13 – Testing Strategies · Automation and watch mode",
            url: "13_testing_strategies/#automation-and-watch-mode"
          }
        },
        {
          recommendation:
            "Monitor coverage with shared fixtures and metrics so gaps trigger backlog improvements.",
          reference: {
            title:
              "Chapter 13 – Testing Strategies · Best practices for infrastructure testing with Vitest",
            url: "13_testing_strategies/#best-practices-for-infrastructure-testing-with-vitest"
          }
        },
        {
          recommendation:
            "Rehearse failure scenarios with codified chaos experiments to validate resilience and recovery paths.",
          reference: {
            title:
              "Chapter 13 – Testing Strategies · Chaos Monkey experiments",
            url: "13_testing_strategies/#chaos-monkey-experiments"
          }
        },
        {
          recommendation:
            "Manage test data, fixtures, and sanitisation routines as code to keep environments repeatable.",
          reference: {
            title:
              "Chapter 13 – Testing Strategies · Best practices for infrastructure testing with Vitest",
            url: "13_testing_strategies/#best-practices-for-infrastructure-testing-with-vitest"
          }
        }
      ],
      documentation: [
        {
          recommendation:
            "Author documentation in version-controlled markup with review workflows so knowledge stays accurate.",
          reference: {
            title:
              "Chapter 22 – Documentation vs Architecture as Code · Documentation as Code: communication and knowledge transfer",
            url: "22_documentation_vs_architecture/#documentation-as-code-communication-and-knowledge-transfer"
          }
        },
        {
          recommendation:
            "Automate publishing pipelines so every change regenerates web, PDF, and diagram outputs from the same sources.",
          reference: {
            title:
              "Chapter 22 – Documentation vs Architecture as Code · Architecture as Code feeds Documentation as Code",
            url: "22_documentation_vs_architecture/#architecture-as-code-feeds-documentation-as-code"
          }
        },
        {
          recommendation:
            "Bake documentation updates into the definition of done so product and platform changes always ship with revised guidance.",
          reference: {
            title:
              "Chapter 22 – Documentation vs Architecture as Code · The relationship between Documentation as Code and Architecture as Code",
            url: "22_documentation_vs_architecture/#the-relationship-between-documentation-as-code-and-architecture-as-code"
          }
        },
        {
          recommendation:
            "Generate diagrams from structured models to eliminate manual drawing effort.",
          reference: {
            title:
              "Chapter 22 – Documentation vs Architecture as Code · Architecture as Code feeds Documentation as Code",
            url: "22_documentation_vs_architecture/#architecture-as-code-feeds-documentation-as-code"
          }
        },
        {
          recommendation:
            "Automate link, style, and quality checks in CI to uphold documentation standards.",
          reference: {
            title:
              "Chapter 22 – Documentation vs Architecture as Code · Key differences: a comparative framework",
            url: "22_documentation_vs_architecture/#key-differences-a-comparative-framework"
          }
        }
      ],
      knowledge: [
        {
          recommendation:
            "Capture organisational knowledge in structured, versioned repositories with clear ownership to reduce onboarding friction.",
          reference: {
            title:
              "Chapter 18 – Team Structure · Knowledge sharing and communities of practice",
            url: "18_team_structure/#knowledge-sharing-and-communities-of-practice"
          }
        },
        {
          recommendation:
            "Provide onboarding journeys as code-based playbooks or scripts so induction follows a consistent, automated path.",
          reference: {
            title:
              "Chapter 23 – Soft as Code Interplay · Knowledge and culture as code",
            url: "23_soft_as_code_interplay/#knowledge-and-culture-as-code"
          }
        },
        {
          recommendation:
            "Track retrospectives and improvement actions in version-controlled artefacts with automated follow-up tasks.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Practical examples of strategic discussions",
            url: "19_management_as_code/#practical-examples-of-strategic-discussions"
          }
        },
        {
          recommendation:
            "Embed cultural guidance into tooling—bots, templates, and prompts—so behaviours are reinforced where work happens.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Cultural and behavioural codification",
            url: "19_management_as_code/#cultural-and-behavioural-codification"
          }
        },
        {
          recommendation:
            "Schedule automated reminders to review knowledge bases and cultural commitments to keep guidance current.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Cultural and behavioural codification",
            url: "19_management_as_code/#cultural-and-behavioural-codification"
          }
        }
      ],
      management: [
        {
          recommendation:
            "Document operating models, team topologies, and responsibilities through codified templates that live in Git.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Defining Management as Code",
            url: "19_management_as_code/#defining-management-as-code"
          }
        },
        {
          recommendation:
            "Run leadership ceremonies from dashboards and scripts generated by management code so rituals stay repeatable.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Embedding management in the DevOps loop",
            url: "19_management_as_code/#embedding-management-in-the-devops-loop"
          }
        },
        {
          recommendation:
            "Collect performance and delivery metrics automatically and surface them through shared management dashboards.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Measuring management effectiveness",
            url: "19_management_as_code/#measuring-management-effectiveness"
          }
        },
        {
          recommendation:
            "Manage resource allocation and staffing through codified workflows with automated approvals and audit trails.",
          reference: {
            title:
              "Chapter 19 – Management as Code · Governance and policy automation",
            url: "19_management_as_code/#governance-and-policy-automation"
          }
        },
        {
          recommendation:
            "Iterate management playbooks via pull requests so the leadership community can review and evolve guidance together.",
          reference: {
            title:
              "Chapter 19 – Management as Code · GitHub configuration for MaC",
            url: "19_management_as_code/#github-configuration-for-mac"
          }
        }
      ]
    };

    document.addEventListener("DOMContentLoaded", () => {
      buildForm();
      const form = document.getElementById("assessmentForm");
      form.addEventListener("submit", handleAssessment);
      document
        .getElementById("copyJson")
        .addEventListener("click", copyJsonToClipboard);
      document
        .getElementById("downloadJson")
        .addEventListener("click", downloadJsonFile);
      document
        .getElementById("triggerImportJson")
        .addEventListener("click", () =>
          document.getElementById("importJsonInput").click()
        );
      document
        .getElementById("importJsonInput")
        .addEventListener("change", handleJsonImport);
    });

    function buildForm() {
      const container = document.getElementById("questionContainer");
      const fragment = document.createDocumentFragment();

      aspects.forEach((aspect) => {
        const fieldset = document.createElement("fieldset");
        const legend = document.createElement("legend");
        legend.textContent = aspect.name;
        fieldset.appendChild(legend);

        aspect.questions.forEach((question, index) => {
          const questionId = `${aspect.key}_${index}`;
          const wrapper = document.createElement("div");
          wrapper.className = "question";

          const label = document.createElement("label");
          label.className = "question-text";
          label.textContent = question;
          wrapper.appendChild(label);

          const options = document.createElement("div");
          options.className = "options";

          const yesOption = createOption(questionId, "yes", "Yes");
          const noOption = createOption(questionId, "no", "No");

          options.appendChild(yesOption);
          options.appendChild(noOption);
          wrapper.appendChild(options);

          fieldset.appendChild(wrapper);
        });

        fragment.appendChild(fieldset);
      });

      container.appendChild(fragment);
    }

    function createOption(name, value, labelText) {
      const label = document.createElement("label");
      const id = `${name}_${value}`;
      const input = document.createElement("input");
      input.type = "radio";
      input.name = name;
      input.value = value;
      input.id = id;
      input.required = true;

      const indicator = document.createElement("span");
      indicator.className = "checkable";
      indicator.textContent = labelText;

      label.setAttribute("for", id);
      label.appendChild(input);
      label.appendChild(indicator);

      return label;
    }

    function handleAssessment(event) {
      event.preventDefault();
      const form = event.target;
      const { detailedResults, resultPayload } = calculateResults(
        form
      );
      updateOutputs(detailedResults, resultPayload);
    }

    function calculateResults(form) {
      const formData = new FormData(form);

      const detailedResults = aspects.map((aspect) => {
        const answers = aspect.questions.map((question, index) => {
          const fieldName = `${aspect.key}_${index}`;
          const response = formData.get(fieldName);
          return {
            question,
            response,
            score: response === "yes" ? 1 : 0
          };
        });

        const yesCount = answers.reduce((acc, item) => acc + item.score, 0);
        const totalQuestions = answers.length;
        const percentage = totalQuestions
          ? Math.round((yesCount / totalQuestions) * 100)
          : 0;

        return {
          aspectKey: aspect.key,
          aspectName: aspect.name,
          yesCount,
          totalQuestions,
          percentage,
          answers
        };
      });

      const resultPayload = {
        generatedAt: new Date().toISOString(),
        scaleMaximum: 5,
        totals: {
          overallYes: detailedResults.reduce((acc, item) => acc + item.yesCount, 0),
          overallQuestions: detailedResults.reduce(
            (acc, item) => acc + item.totalQuestions,
            0
          ),
          averagePercentage:
            detailedResults.reduce((acc, item) => acc + item.percentage, 0) /
            detailedResults.length
        },
        aspects: detailedResults
      };

      return { detailedResults, resultPayload };
    }

    function updateOutputs(detailedResults, resultPayload) {
      const radarDefinition = buildRadarDefinition(detailedResults);
      renderRadar(radarDefinition);
      renderSummaryTable(detailedResults);
      renderSuggestions(collectImprovementSuggestions(detailedResults));

      const jsonOutput = document.getElementById("jsonOutput");
      jsonOutput.value = JSON.stringify(resultPayload, null, 2);
    }

    function buildRadarDefinition(results) {
      const axes = [
        { key: "iac", label: "Infrastructure as code (IaC)" },
        { key: "aac", label: "Architecture as code (AaC)" },
        { key: "cont", label: "Containerisation & orchestration as code" },
        {
          key: "pacsec",
          label: "Policy as code (PaC) & Security as code"
        },
        { key: "gov", label: "Governance as code" },
        { key: "comp", label: "Compliance as code" },
        { key: "test", label: "Testing as code" },
        { key: "doc", label: "Documentation as code" },
        { key: "culture", label: "Knowledge & culture as code" },
        { key: "mgmt", label: "Management as code" }
      ];

      const axisLines = axes
        .map(
          ({ key, label }) =>
            `    ${key}: "${label.replace(/"/g, '\\"')}"`
        )
        .join("\n");

      const dataSeries = axes
        .map(({ key }) => {
          const match = results.find((result) => result.aspectKey === key);
          if (!match || !match.totalQuestions) {
            return 0;
          }

          const normalisedScore = (match.yesCount / match.totalQuestions) * 5;
          return Number(normalisedScore.toFixed(2));
        })
        .join(", ");

      return [
        "radar",
        "  title: Architecture as Code Maturity Snapshot",
        "  axis:",
        axisLines,
        "  dataset:",
        "    title: Current assessment",
        `    data: [${dataSeries}]`,
        "  min: 0",
        "  max: 5",
        "  ticks: 5",
        "  showLegend: true"
      ].join("\n");
    }

    async function renderRadar(definition) {
      const container = document.getElementById("radarDiagram");
      const targetId = `radar_${Date.now()}`;
      try {
        const { svg } = await mermaid.render(targetId, definition);
        container.innerHTML = svg;
      } catch (error) {
        console.error("Failed to render Mermaid diagram", error);
        container.innerHTML = "";

        const errorWrapper = document.createElement("div");
        errorWrapper.className = "diagram-error";
        errorWrapper.setAttribute("role", "alert");

        const intro = document.createElement("p");
        intro.textContent =
          "Mermaid reported a syntax error while generating the radar diagram. Review the definition below to troubleshoot the issue.";
        errorWrapper.appendChild(intro);

        const message = document.createElement("p");
        message.className = "error-message";
        message.textContent = error?.message
          ? `Mermaid error: ${error.message}`
          : "Mermaid returned an unknown error.";
        errorWrapper.appendChild(message);

        const details = document.createElement("details");
        details.open = true;

        const summary = document.createElement("summary");
        summary.textContent = "View Mermaid definition";
        details.appendChild(summary);

        const textarea = document.createElement("textarea");
        textarea.readOnly = true;
        textarea.value = definition;
        textarea.rows = Math.min(12, definition.split("\n").length + 2);
        textarea.setAttribute(
          "aria-label",
          "Mermaid definition for the radar diagram"
        );
        details.appendChild(textarea);

        const copyButton = document.createElement("button");
        copyButton.type = "button";
        copyButton.textContent = "Copy Mermaid definition";
        copyButton.addEventListener("click", async () => {
          await copyTextToClipboard(definition);
          const original = copyButton.textContent;
          copyButton.textContent = "Definition copied";
          setTimeout(() => {
            copyButton.textContent = original;
          }, 2000);
        });
        details.appendChild(copyButton);

        errorWrapper.appendChild(details);
        container.appendChild(errorWrapper);
      }
    }

    function renderSummaryTable(results) {
      const summaryContainer = document.getElementById("resultSummary");
      const table = document.createElement("table");

      const headerRow = document.createElement("tr");
      [
        "Aspect",
        "Affirmative responses",
        "Total questions",
        "Percentage"
      ].forEach((heading) => {
        const th = document.createElement("th");
        th.textContent = heading;
        headerRow.appendChild(th);
      });
      table.appendChild(headerRow);

      results.forEach((result) => {
        const row = document.createElement("tr");

        const aspectCell = document.createElement("td");
        aspectCell.textContent = result.aspectName;
        row.appendChild(aspectCell);

        const yesCell = document.createElement("td");
        yesCell.textContent = result.yesCount;
        row.appendChild(yesCell);

        const totalCell = document.createElement("td");
        totalCell.textContent = result.totalQuestions;
        row.appendChild(totalCell);

        const percentageCell = document.createElement("td");
        percentageCell.textContent = `${result.percentage}%`;
        row.appendChild(percentageCell);

        table.appendChild(row);
      });

      summaryContainer.innerHTML = "";
      summaryContainer.appendChild(table);
    }

    function collectImprovementSuggestions(results) {
      const suggestions = [];

      results.forEach((result) => {
        result.answers.forEach((answer, index) => {
          if (answer.response !== "no") {
            return;
          }

          const aspectSuggestions = suggestionIndex[result.aspectKey] ?? [];
          const suggestionDefinition = aspectSuggestions[index];

          if (!suggestionDefinition) {
            return;
          }

          suggestions.push({
            aspectName: result.aspectName,
            question: answer.question,
            recommendation: suggestionDefinition.recommendation,
            reference: suggestionDefinition.reference
          });
        });
      });

      return suggestions;
    }

    function renderSuggestions(suggestions) {
      const container = document.getElementById("improvementSuggestions");
      if (!container) {
        return;
      }

      container.innerHTML = "";

      if (!suggestions.length) {
        const placeholder = document.createElement("p");
        placeholder.textContent =
          "Complete the assessment to receive targeted recommendations for boosting your maturity.";
        container.appendChild(placeholder);
        return;
      }

      const intro = document.createElement("p");
      intro.textContent =
        "Focus on the following actions to raise your maturity across disciplines:";
      container.appendChild(intro);

      const list = document.createElement("ol");

      suggestions.forEach((suggestion) => {
        const item = document.createElement("li");

        const questionLabel = document.createElement("p");
        questionLabel.className = "question-label";
        questionLabel.textContent = `${suggestion.aspectName} – ${suggestion.question}`;
        item.appendChild(questionLabel);

        const recommendation = document.createElement("p");
        recommendation.textContent = suggestion.recommendation;
        item.appendChild(recommendation);

        if (suggestion.reference) {
          const referenceLink = document.createElement("a");
          referenceLink.className = "reference-link";
          referenceLink.href = suggestion.reference.url;
          referenceLink.target = "_blank";
          referenceLink.rel = "noopener noreferrer";
          referenceLink.textContent = suggestion.reference.title;
          item.appendChild(referenceLink);
        }

        list.appendChild(item);
      });

      container.appendChild(list);
    }

    async function copyTextToClipboard(text) {
      if (!text) {
        return;
      }

      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        return;
      }

      const helper = document.createElement("textarea");
      helper.value = text;
      helper.setAttribute("readonly", "");
      helper.style.position = "absolute";
      helper.style.left = "-9999px";
      document.body.appendChild(helper);
      helper.select();
      document.execCommand("copy");
      document.body.removeChild(helper);
    }

    async function copyJsonToClipboard() {
      const jsonOutput = document.getElementById("jsonOutput");
      if (!jsonOutput.value) {
        return;
      }

      await copyTextToClipboard(jsonOutput.value);
    }

    function downloadJsonFile() {
      const jsonOutput = document.getElementById("jsonOutput").value;
      if (!jsonOutput) {
        return;
      }
      const blob = new Blob([jsonOutput], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "aac_maturity_assessment.json";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    function handleJsonImport(event) {
      const [file] = event.target.files;
      if (!file) {
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        try {
          const data = JSON.parse(reader.result);
          applyImportedAssessment(data);
        } catch (error) {
          console.error("Failed to parse assessment JSON", error);
          alert(
            "The selected file could not be parsed. Please ensure it is a valid assessment export."
          );
        }
      };
      reader.readAsText(file);

      event.target.value = "";
    }

    function applyImportedAssessment(data) {
      if (!data || !Array.isArray(data.aspects)) {
        alert("The imported data is missing the expected structure.");
        return;
      }

      const form = document.getElementById("assessmentForm");
      form.reset();

      data.aspects.forEach((aspectResult) => {
        const aspectDefinition = aspects.find(
          (definition) => definition.key === aspectResult.aspectKey
        );

        if (!aspectDefinition || !Array.isArray(aspectResult.answers)) {
          return;
        }

        aspectResult.answers.forEach((answer, index) => {
          if (!answer || !answer.response) {
            return;
          }

          const fieldName = `${aspectDefinition.key}_${index}`;
          const radio = document.querySelector(
            `input[name="${fieldName}"][value="${answer.response}"]`
          );
          if (radio) {
            radio.checked = true;
          }
        });
      });

      const { detailedResults, resultPayload } = calculateResults(form);
      updateOutputs(detailedResults, resultPayload);
    }
  </script>
</head>
<body>
  <header>
    <h1>Architecture as Code Maturity Radar</h1>
    <p class="intro">
      Answer each question to reflect how far your organisation has progressed with Architecture as Code practices.
      Submit the assessment to generate a radar diagram and exportable JSON summary capturing every response.
    </p>
  </header>

  <main>
    <form id="assessmentForm">
      <div id="questionContainer"></div>
      <div class="actions">
        <button type="submit" class="primary">Generate radar and summary</button>
        <button type="reset" class="warning">Clear responses</button>
      </div>
    </form>

    <section id="radarDiagram" aria-live="polite">
      <p>The radar diagram will appear here once you submit the assessment.</p>
    </section>

    <section class="result-summary">
      <h2>Summary by discipline</h2>
      <div id="resultSummary">
        <p>Submit your answers to view a breakdown of the results.</p>
      </div>
    </section>

    <section class="improvement-suggestions">
      <h2>Improvement suggestions</h2>
      <div id="improvementSuggestions">
        <p>Complete the assessment to receive targeted recommendations for boosting your maturity.</p>
      </div>
    </section>

    <section class="result-summary">
      <h2>JSON export</h2>
      <p>The JSON payload includes the radar data and individual answers so you can archive or process the assessment.</p>
      <textarea id="jsonOutput" readonly aria-label="Assessment results in JSON format"></textarea>
      <div class="actions">
        <button type="button" id="copyJson">Copy JSON to clipboard</button>
        <button type="button" id="downloadJson">Download JSON file</button>
        <button type="button" id="triggerImportJson">Import JSON file</button>
        <input
          type="file"
          id="importJsonInput"
          accept="application/json"
          hidden
          aria-hidden="true"
        />
      </div>
    </section>
  </main>
</body>
</html>
